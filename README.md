# Краткое описание
System design социальной сети для путешественников по курсу https://balun.courses/courses/system_design

# Исходные требования бизнеса
У бизнеса **есть четкое понимание функциональности**, которая эта социальная сеть должна будет предоставлять в будущем:

- публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест;
- просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке;

 
> Что касается будущей аудитории социальной сети - у бизнеса есть огромные средства для рекламы и продвижения социальной сети, поэтому пользовательская база будет постепенно линейно расти и предполагается, что через год достигнет примерно 10 000 000 уникальных пользователей в день, после чего также будет продолжать расти. Бизнес пока нацелен  только на аудиторию стран СНГ (*на зарубежный рынок выходить планов нет*). Будущая система должна быть очень надежной, а также, чтобы с ней было удобно взаимодействовать, используя мобильные устройства и браузер.

# Функциональные требования
### Профиль пользователя
- Создание профиля: имя, краткое описание
- Просмотр истории лайков к постам

### Вход
- Аутентификация пользователей по логину и паролю

### Работа с постами
- Содержание поста: фотографии, небольшое описание, геолокация, кол-во лайков и кол-во комментариев
- Создание поста с публикацией сразу
- Удаление поста
- Редактирование поста не делаем

### Оценка и комментарии
- Добавление\удаление комментариев к постам других пользователей и своим
- Добавление\удаление оценки постов других пользователей и своих
- Оценка в виде лайков
- Комментарии с возможностью ответа (древовидная структура)

### Работа с подписками
- Пользователь может подписаться\отписаться на других пользователей
- Пользователь может просмотреть список своих подписок
- Пользователь может посмотреть список подписок другого пользователя

### Лента
- Просмотр поста: фото, описание, геолокация, комментарии и оценки
- Просмотр ленты с постами:
  - Посмотр своей ленты
  - Просмотр ленты другого пользователя
  - Просмотр ленты, основанной на подписках пользователя в обратной хронологии

### Поиск мест
- Поиск популярных мест с фильтрацией: по кол-ву оценок, по странам\городам

# Нефункциональные требования
- Аудитория:
  - Только страны СНГ
  - DAU: 10 000 000
- Посты:
  - Среднее кол-во постов 1 пост в неделю = ~ 0,14 поста в сутки.
  - Макс кол-во постов пользователя: не ограничено
  - Храним всегда
  - Длина описания до 1000 символов
  - Фото:
    - 1 фото до 2 Мб
    - Формат JPG и PNG
    - До 5 фото в 1 посте
- Оценки и комментарии
  - Проставление лайков в среднем за сутки: 20
  - Количество комментариев в среднем в сутки: 1
  - Лимит лайков: 1000
  - Лимит комментариев: 500
 - Подписки
   - Лимит подписок в сутки: 100
   - Среднее количество подписок в день: 1
   - Просмотр списка свои или чужих подписок в сутки: 1
- Лента
  - Просмотр ленты в сутки в среднем: 5 раз по 10 постов
  - Ограничение по загрузке ленты: до 10 постов на странице
- Поиск
  -  В среднем по 2 поиска в день
- Сезонность
  - Праздники + лето, в эти периоды считаем х3 по созданию постов
- Тайминги:
  - Создание поста: до 3 сек
  - Получение 1 страницы ленты: до 2 сек
  - Поиск: до 2 сек
  - Оценка: до 500ms
  - Комментарий: до 1 сек
- Доступность:
  - 99,999%
 
 # Оценка нагрузки для поста

### Рассчёт
- 1 пост (метаинформация) ~1076 байт ~ 1 КБайт:
  - id (uuid) 16 байт
  - description (varchar 1000) 1004 байт
  - user_id (uuid) 16 байт
  - location (point) 16 байт
  - likes_count (int) 4 байта
  - comments_count (int) 4 байта
  - created_at (timestamp) 8 байт
  - deleted_at (timestamp) 8 байт
- 1 файл поста (медиа) ~5 Мб + 300 байт на доп. инфу (считаем как 5 Мбайт)
- 1 лайк ~40 байт
  - post_id (uuid) 16 байт
  - user_id (uuid) 16 байт
  - created_at (timestamp) 8 байт

### RPS 
    Создание поста:
    DAU = 10 000 000
    RPS = 10 000 000 * 0.14 / 86 400 = ~ 16
    RPS в сезон 48

    Получение списка постов:
    DAU = 10 000 000
    RPS = 10 000 000 * 5 / 86 400 = ~ 580

    Поставить лайк:
    DAU = 10 000 000
    RPS = 10 000 000 * 20 / 86 400 = ~ 2 400

### Traffic
    Создание поста:
    traffic (для метаинфы) = 16rps * (1 Кбайт на метаинформацию) = 16 Кбайт\с (в Сезон 48)
    traffic (для медиа) = 16rps * (2 Мбайт * 5 шт в посте) = 160 Мб\с (в сезон 480)
    
    Получение списка постов:
    traffic (для метаинфы) = 580rps * 10постов * (1 Кбайт на метаинформацию) = 5,8 Мбайт\с
    traffic (для медиа, максимальный) = 580rps * 10постов * (2 Мбайт * 5 шт в посте) = 58 Гбайт\с

    Поставить лайк:
    traffic = 2400rps * 40 байт = 96 КБайт

### Memory (без учёта сезонности)
    Хранение файлов: всегда
    Считаем сколько понадобится хранения в год для 10 000 000 пользователей
    Кол-во постов в год для 1 пользователя: ~ 50 шт
    В каждом посте максимум по 5 фото по 2 Мбайта: 10 Мбайт на пост -> 500 Мбайт на посты в год на человека
    Итого для 10 000 000 млн пользователей в год нужно: 10 000 000 * 500 Мбайт = 5 Петабайт
